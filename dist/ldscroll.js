// Generated by LiveScript 1.6.0
(function(){
  var main;
  main = function(opt){
    var root, this$ = this;
    opt == null && (opt = {});
    this.opt = opt;
    root = opt.root;
    this.root = root = typeof root === 'string'
      ? document.querySelector(root)
      : root ? root : null;
    this.io = new IntersectionObserver(function(){
      var args, res$, i$, to$;
      res$ = [];
      for (i$ = 0, to$ = arguments.length; i$ < to$; ++i$) {
        res$.push(arguments[i$]);
      }
      args = res$;
      return this$.handler.apply(this$, args);
    }, {
      root: this.root
    });
    this.nodes = [];
    this.data = [];
    this.visible = [];
    this.add(opt.nodes);
    this.evtHandler = {};
    window.addEventListener('scroll', function(){
      this$.data.map(function(it, i){
        var b;
        b = it.node.getBoundingClientRect();
        it.yb = (b.y + b.height) / window.innerHeight;
        return it.yt = b.y / window.innerHeight;
      });
      return this$.fire('change', this$.data);
    });
    return this;
  };
  main.prototype = import$(Object.create(Object.prototype), {
    on: function(n, cb){
      var ref$;
      return ((ref$ = this.evtHandler)[n] || (ref$[n] = [])).push(cb);
    },
    fire: function(n){
      var v, res$, i$, to$, ref$, len$, cb, results$ = [];
      res$ = [];
      for (i$ = 1, to$ = arguments.length; i$ < to$; ++i$) {
        res$.push(arguments[i$]);
      }
      v = res$;
      for (i$ = 0, len$ = (ref$ = this.evtHandler[n] || []).length; i$ < len$; ++i$) {
        cb = ref$[i$];
        results$.push(cb.apply(this, v));
      }
      return results$;
    },
    add: function(ns){
      var this$ = this;
      this.nodes = this.nodes.concat((Array.isArray(ns)
        ? ns
        : [ns]).map(function(it){
        if (typeof it === 'string') {
          return Array.from(document.querySelectorAll(it));
        } else {
          return it;
        }
      }).reduce(function(a, b){
        return a.concat(b);
      }, []));
      this.nodes.forEach(function(it, i){
        var b;
        b = it.getBoundingClientRect();
        it._ldscroll = {
          node: it,
          yt: b.y / window.innerHeight,
          yb: (b.y + b.height) / window.innerHeight
        };
        return this$.io.observe(it);
      });
      return this.data = this.data.concat(this.nodes.map(function(it){
        return it._ldscroll;
      }));
    },
    handler: function(entries){
      var ret, this$ = this;
      ret = entries.filter(function(entry){
        var d;
        d = entry.target._ldscroll;
        if (d.visible !== entry.isIntersecting) {
          d.visible = entry.isIntersecting;
          if (d.visible && !in$(d, this$.visible)) {
            this$.visible.push(d);
          }
          if (!d.visible && in$(d, this$.visible)) {
            this$.visible.splice(this$.visible.indexOf(d), 1);
          }
          return true;
        }
        return false;
      });
      ret = ret.map(function(it){
        var d;
        d = it.target._ldscroll;
        d.entry = it;
        return d;
      });
      if (ret.length) {
        return this.fire('change', ret);
      }
    }
  });
  if (typeof window != 'undefined' && window !== null) {
    window.ldscroll = main;
  }
  function import$(obj, src){
    var own = {}.hasOwnProperty;
    for (var key in src) if (own.call(src, key)) obj[key] = src[key];
    return obj;
  }
  function in$(x, xs){
    var i = -1, l = xs.length >>> 0;
    while (++i < l) if (x === xs[i]) return true;
    return false;
  }
}).call(this);
