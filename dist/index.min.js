!function(){var t;function o(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}(t=function(t){var i=this,e=(this.opt=t=null==t?{}:t).root;return this.root=e="string"==typeof e?document.querySelector(e):e||null,this.evtHandler={},this.io=new IntersectionObserver(function(){for(var t,e=[],n=0,r=arguments.length;n<r;++n)e.push(arguments[n]);return t=e,i.handler.apply(i,t)},{root:this.root}),this.tov=null==t.trackOutsideView||t.trackOutsideView,this.map=new("undefined"!=typeof WeakMap&&null!==WeakMap?WeakMap:Map),this.nodes=[],this.data=[],this.visible=[],this.trackee=[],this.add(t.nodes),this.root.addEventListener("scroll",function(){var t=i.tov?i.data:i.trackee;return t.map(function(t,e){var n=t.node.getBoundingClientRect();return t.yb=(n.y+n.height)/window.innerHeight,t.yt=n.y/window.innerHeight,t.yp=t.yt/(1-(t.yb-t.yt)),t.progress=t.yp<0?-t.yt:1<t.yp?2-t.yb:t.yp}),i.fire("change",t)}),this}).prototype=function(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}(Object.create(Object.prototype),{on:function(t,e){var n;return((n=this.evtHandler)[t]||(n[t]=[])).push(e)},fire:function(t){for(var e,n,r,i,o=[],s=[],a=1,u=arguments.length;a<u;++a)s.push(arguments[a]);for(e=s,a=0,r=(n=this.evtHandler[t]||[]).length;a<r;++a)i=n[a],o.push(i.apply(this,e));return o},getVisible:function(){return this.visible},add:function(t,r){var i,o=this;return null==r&&(r=this.tov),this.nodes=this.nodes.concat((Array.isArray(t)?t:[t]).map(function(t){return"string"==typeof t?Array.from(document.querySelectorAll(t)):t}).reduce(function(t,e){return t.concat(e)},[])),i=window.innerHeight,t=this.nodes.map(function(t,e){var n=t.getBoundingClientRect();return o.map.set(t,n={node:t,tov:r,yt:n.y/i,yb:(n.y+n.height)/i}),n.yp=n.yt/(1-(n.yb-n.yt)),n.progress=n.yp<0?-n.yt:1<n.yp?2-n.yb:n.yp,o.io.observe(t),n}),this.data=this.data.concat(t),this.trackee=this.trackee.concat(t.filter(function(t){return t.tov}))},handler:function(t){var i=this,t=t.map(function(t){var e;return(e=i.map.get(t.target))&&(e.entry=t),e}).filter(function(t){var e,n,r;return!(!t||t.visible===t.entry.isIntersecting)&&(e=t.visible=t.entry.isIntersecting,n=(r=[o(t,i.visible),o(t,i.trackee)])[0],r=r[1],e&&!n&&i.visible.push(t),!e&&n&&i.visible.splice(i.visible.indexOf(t),1),t.tov||(e&&!r&&i.trackee.push(t),!e&&r&&i.trackee.splice(i.trackee.indexOf(t),1)),!0)});if(t.length)return this.fire("change",t)}}),"undefined"!=typeof module&&null!==module?module.exports=t:window.ldscroll=t}.call(this);
